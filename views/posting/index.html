{% extends 'initial/layout.html' %}
{% block content %}
<div class="container">
  <h1>Post</h1>
  <div class="post-area">
    <form action="{{ctx.DOMAIN_NAME}}/posts" method="post" id="post-form">
      <textarea name="post" id="" cols="100" rows="3"></textarea>
      <button type="submit">post</button>
    </form>
  </div>
  <div class="post-container">
    {% for p in posts|sort('datetime')|reverse  %}
    <div>
      <div>
        <hr>
        <!-- id : {{p._id}} -->
        <h4>Post</h4>
        <div>{{p.datetime}}</div>
        <p>
          {{ p.post }}
        </p>
        <div class="reply-form-container mx-5">
          <form action="{{ctx.DOMAIN_NAME}}/posts/comments" method="post" id="reply-form">
            <input name="postId" type="text" value="{{p._id}}" hidden>
            <input name="comment" type="text" size="20">
            <input type="submit" value="submit">
          </form>
          <div class="reply-container mx-5">
            <h4>Comments</h4>
            {% for c in comments|sort("datetime") %}

            {% set p1 = p._id.toString() %}
            {% set p2 = c.postId.toString() %}

            {% if (p1 == p2) %}
            <!-- id: {{c._id }} -->
            <hr>
            <div>{{c.datetime}}</div>
            <p>
              {{ c.comment }}
            </p>
            {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}