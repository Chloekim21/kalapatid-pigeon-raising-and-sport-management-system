{% extends '__init__/layout.html' %}
{% block content %}

	<div class="container-fluid">
		<div class="row">
			<div class="col-lg-4">
				<div class="cards">
					<div class="d-flex justify-content-between align-items-center" style="height: 50px;">
						<h5 class="fw-bold">Club</h5>
						{% if club.founderName == username %}
							<div class="d-flex">
								<a href="#">
									<i class="icons fa-solid fa-gear"></i>
								</a>
							</div>
						{% endif %}
					</div>

					<div>
						<div class="card-body">
							<div class="w-100 text-center my-3">
								<img src="/images/club.jpg" style="width: 100px; height: 90px;" id="account-picture">
							</div>
							<div class="w-auto">
								<div >
									<p class="fw-bolder">Club Name</p>
									<div class="h2">{{club.name}}</div>

									<p class="fw-bolder">Club Founder</p>
									<a href="{{ctx.DOMAIN_NAME}}/profile?username={{club.founderName}}">
										<p>@{{club.founderName}}</p>
									</a>
									<p class="fw-bolder">Creation Date</p>
									<p>{{club.date | date_formatter}}</p>

									<h5 class="fw-bold">Description</h5>
									<div>{{club.description}}</div>
									{# accessable only if you are a member of the club #}
									{# ===================================================== #}
									<span>
										{% for member in clubMembers %}
											{% if member.accountId == accountId %}
												<a href="{{ctx.DOMAIN_NAME}}/chats/show?clubId={{club._id}}" class="d-inline-block btn btn-sm btn-success w-25">Club Chat</a>
												{# and if account is the founder you have this option  #}
												{# ===================================================== #}

												{% if club.creatorId == accountId %}
													<a class="d-inline-block btn btn-sm btn-success my-2 w-25" href="{{ctx.DOMAIN_NAME}}/events/create?clubName={{club.name}}&clubId={{club._id}}">Create Event</a>
													{% endif%}
													{# ===================================================== #}

													{%endif%}
												{% endfor %}
												{# ===================================================== #}

												{# accessable only if you are not creator of the clubs or the founder #}
												{# ===================================================== #}
												{% for member in clubMembers %}
													{% if club.creatorId != accountId and club._id == member.clubId %}
														{% if member.accountId == accountId %}
															<form method="POST" action="{{ctx.DOMAIN_NAME}}/clubs/membership/request">
																<input type="text" name="clubId" value="{{club._id}}" hidden="true">
																<input class="d-inline-block btn btn-sm btn-success my-2 w-25" type="submit" value="Join">
															</form>
															{% endif%}
															{% endif%}
														{% endfor %}
													</span>

													{# ===================================================== #}

												</div>
											</div>
											<br>
										</div>
										<br>
									</div>
								</div>
							</div>

							<div class="col-lg-8">
								<div class="row">
									{# accessable only if you are a member of the club #}
									{# ===================================================== #}
									{% for member in clubMembers %}
										{% if member.accountId == accountId and member.memberStatus == "accepted" %}
											<div class="col-lg-12">
												<main>
													<div class="cards">
														<div class="card-content">
															<h5 class="fw-bold">Events</h5>
														</div>
														<div class="card-body">
															{% if events | is_empty %}
																<p class="text-center">No Event yet.</p>
															{% endif %}
															<div style="overflow-y: auto; height: 100px;">
																<ul>
																	{% for e in events %}
																		<li>
																			<a class="text-decoration-none text-success" href="{{ctx.DOMAIN_NAME}}/events/show?eventId={{e._id}}&clubId={{club._id}}">{{e.name}}</a>
																		</li>
																	{% endfor %}
																</ul>
															</div>
														</div>
													</div>
												</main>
											</div>
											{%endif%}
										{% endfor %}
										{# ===================================================== #}

										{# accessable only if you are the creator of the clubs or the founder #}
										{# ===================================================== #}

										{% if club.creatorId == accountId %}
											<div class="col-lg-12">
												<main>
													<div class="cards">
														<div class="card-content">
															<h5 class="fw-bold">Membership Requests</h5>
														</div>
														<div class="card-body">
															{% if clubMembers | is_empty %}
																<p class="text-center">No Member Requests.</p>
															{% endif %}
															{% set count = 0 -%}
															<table class="table table-borderless">
																{% for member in clubMembers %}
																	{% if member.memberStatus == "pending" %}
																		{% set count =count + 1 -%}
																		<form method="POST" action="{{ctx.DOMAIN_NAME}}/clubs/membership">
																			<tr>
																				<td>
																					<a class="text-decoration-none text-success" href="{{ctx.DOMAIN_NAME}}/profile?username={{member.username}}">@{{member.username}}</a>
																				</td>
																				<td>
																					<input type="text" name="id" value="{{member._id}}" hidden="true">
																					<input type="text" name="clubId" value="{{member.clubId}}" hidden="true">
																					<input type="text" name="accountId" value="{{member.accountId}}" hidden="true">
																					<input id="status-{{member._id}}" type="text" name="status" hidden="true">
																					<button id="btn-accept-{{member._id}}" class="d-inline-block btn-sm btn-success">accept</button>
																					<button id="btn-decline-{{member._id}}" class="d-inline-block btn-sm btn-danger">decline</button>
																					<script>
																						$("#btn-accept-{{member._id}}").click((e) => {
																							$("#status-{{member._id}}").val("accepted")
																						})
																						$("#btn-decline-{{member._id}}").click((e) => {
																							$("#status-{{member._id}}").val("declined")
																						})
																					</script>
																				</td>
																			</form>
																		{%else %}

																			{%endif%}
																		</tr>
																		{%endfor%}
																	</div>
																	{% if count == 0 %}
																		<p class="text-center">No Member Requests.</p>
																		{%endif%}
																	</table>

																</div>
															</div>
														</main>
													</div>
												{% endif %}
												{# ===================================================== #}

												{# accessable to all user #}
												{# ===================================================== #}
												<div class="col-lg-12">
													<main>
														<div class="cards">
															<div class="card-content">
																<h5 class="fw-bold">Members</h5>
															</div>
															<div class="card-body">
																{% if clubMembers | is_empty %}
																	<p class="text-center">No Members.</p>
																{% endif %}
																<div style="overflow-y: auto; height: 100px;">
																	<ul>
																		{% for member in clubMembers %}
																			{% if member.memberStatus == "accepted" %}
																				<li>
																					<a class="text-decoration-none text-success" href="{{ctx.DOMAIN_NAME}}/profile?username={{member.username}}">@{{member.username}}</a>
																				</li>
																				{%endif%}
																			{% endfor %}
																		</ul>
																	</div>
																</div>
															</div>
														</main>
													</div>
													{# ===================================================== #}

												</div>
											</div>
										</div>
									</div>

								{% endblock %}